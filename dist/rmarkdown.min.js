var rmarkdown=function(){function t(t){if(this._div=t.el,this._sourceDiv=document.createElement("div"),this._sourceDiv.setAttribute("contenteditable",!0),this._sourceDiv.textContent=t.default||" ",this._htmlDiv=document.createElement("div"),this._div.appendChild(this._htmlDiv),this._div.appendChild(this._sourceDiv),this._lines=[],this.addLine=this.lineIterator(),t.value){var e=this;t.value.split("\n").map(function(t){var n=e.addLine(t),i=document.createElement("span");i.setAttribute("data-line-no",n.lineNo),i.innerHTML=n.html,e.setEditListener(i),e._htmlDiv.appendChild(i)})}this.attachEvents(),this.placeCaretAtEnd(this._sourceDiv)}return t.prototype.attachEvents=function(){function t(t){if(n.isMyEvent(t)){var e=n.addLine(n._sourceDiv.textContent),i=document.createElement("span");i.setAttribute("data-line-no",e.lineNo),i.innerHTML=e.html,n.setEditListener(i),n._htmlDiv.appendChild(i),n._sourceDiv.textContent=""}}function e(){setTimeout(function(){n.placeCaretAtEnd(n._sourceDiv)},200)}var n=this;n._sourceDiv.addEventListener("keydown",t),n._sourceDiv.addEventListener("mousedown",function(t){t.stopPropagation()}),n._div.addEventListener("mousedown",e),document.addEventListener("mousedown",function(){var t=document.getElementById("my-god-editing");if(t){var e=t.parentNode,i=e.getAttribute("data-line-no");n._lines[i]=t.textContent;var o=marked(t.textContent);e.firstChild=null,e.innerHTML=o}})},t.prototype.setEditListener=function(t){function e(e){e.stopPropagation(),t.innerHTML='<div contenteditable="true" id="my-god-editing">'+o._lines[r]+"</div>",setTimeout(function(){o.placeCaretAtEnd(t.firstChild)},200),t.firstChild.addEventListener("mousedown",function(t){t.stopPropagation()},!0)}function n(t){o.isMyEvent(t)&&(i.call(this),o.placeCaretAtEnd(o._sourceDiv))}function i(){var e=marked(this.textContent);o._lines[r]=this.textContent,t.firstChild=null,t.innerHTML=e}var o=this,r=t.getAttribute("data-line-no");t.addEventListener("mousedown",e),t.addEventListener("keyup",n)},t.prototype.placeCaretAtEnd=function(t){if(t.focus(),"undefined"!=typeof window.getSelection&&"undefined"!=typeof document.createRange){var e=document.createRange();e.selectNodeContents(t),e.collapse(!1);var n=window.getSelection();n.removeAllRanges(),n.addRange(e)}else if("undefined"!=typeof document.body.createTextRange){var i=document.body.createTextRange();i.moveToElementText(t),i.collapse(!1),i.select()}},t.prototype.markdown=function(){return this._lines.join("\n")},t.prototype.html=function(){return this._htmlDiv.outerHTML},t.prototype.isMyEvent=function(t){return 13===t.keyCode&&!t.shiftKey},t.prototype.lineIterator=function(){var t=0,e=this;return function(n){var i=marked(n);return e._lines[t]=n,t++,{html:i,lineNo:t-1}}},t}();